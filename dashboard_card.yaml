# ============================================
# DASHBOARD CARD - LOG ANALYZER (Multi-language)
# ============================================

type: vertical-stack
cards:
  # Header avec stats globales
  - type: entities
    title: >
      {% set lang = states('input_select.ha_log_analyzer_language') %}
      {% if lang == 'fr' %}üìä Analyse des Logs HA
      {% elif lang == 'de' %}üìä HA Log-Analyse
      {% else %}üìä HA Log Analysis{% endif %}
    show_header_toggle: false
    entities:
      - entity: sensor.ha_log_analysis
        name: >
          {% set lang = states('input_select.ha_log_analyzer_language') %}
          {% if lang == 'fr' %}Erreurs/Warnings totaux
          {% elif lang == 'de' %}Fehler/Warnungen gesamt
          {% else %}Total Errors/Warnings{% endif %}
        icon: mdi:alert-circle
      - type: attribute
        entity: sensor.ha_log_analysis
        attribute: total_entries
        name: >
          {% set lang = states('input_select.ha_log_analyzer_language') %}
          {% if lang == 'fr' %}Entr√©es totales
          {% elif lang == 'de' %}Gesamteintr√§ge
          {% else %}Total entries{% endif %}
        icon: mdi:file-document
      - entity: input_select.ha_log_analyzer_language
        name: "üåç Langue / Language / Sprache"
      - type: divider
      - type: button
        name: >
          {% set lang = states('input_select.ha_log_analyzer_language') %}
          {% if lang == 'fr' %}Analyser maintenant
          {% elif lang == 'de' %}Jetzt analysieren
          {% else %}Analyze now{% endif %}
        icon: mdi:refresh
        tap_action:
          action: call-service
          service: script.analyze_logs_now

  # Top erreurs
  - type: markdown
    title: >
      {% set lang = states('input_select.ha_log_analyzer_language') %}
      {% if lang == 'fr' %}üîù Top Erreurs
      {% elif lang == 'de' %}üîù Top Fehler
      {% else %}üîù Top Errors{% endif %}
    content: >
      {% set top = state_attr('sensor.ha_log_analysis', 'top_errors') %}
      {% if top %}
      {% for err in top[:5] %}
      **{{ loop.index }}. [{{ err.integration }}]** x{{ err.count }}
      {{ err.message[:80] }}{% if err.message|length > 80 %}...{% endif %}
      
      {% endfor %}
      {% else %}
      {% set lang = states('input_select.ha_log_analyzer_language') %}
      {% if lang == 'fr' %}Aucune donn√©e. Lancez une analyse.
      {% elif lang == 'de' %}Keine Daten. F√ºhren Sie eine Analyse durch.
      {% else %}No data. Run an analysis.{% endif %}
      {% endif %}

  # Par s√©v√©rit√©
  - type: markdown
    title: >
      {% set lang = states('input_select.ha_log_analyzer_language') %}
      {% if lang == 'fr' %}üìà Par S√©v√©rit√©
      {% elif lang == 'de' %}üìà Nach Schweregrad
      {% else %}üìà By Severity{% endif %}
    content: >
      {% set sev = state_attr('sensor.ha_log_analysis', 'by_severity') %}
      {% if sev %}
      üî¥ **CRITICAL:** {{ sev.CRITICAL | default(0) }}
      üü† **ERROR:** {{ sev.ERROR | default(0) }}
      üü° **WARNING:** {{ sev.WARNING | default(0) }}
      {% else %}
      {% set lang = states('input_select.ha_log_analyzer_language') %}
      {% if lang == 'fr' %}Aucune donn√©e.
      {% elif lang == 'de' %}Keine Daten.
      {% else %}No data.{% endif %}
      {% endif %}

  # Top int√©grations
  - type: markdown
    title: >
      {% set lang = states('input_select.ha_log_analyzer_language') %}
      {% if lang == 'fr' %}üì¶ Top Int√©grations
      {% elif lang == 'de' %}üì¶ Top Integrationen
      {% else %}üì¶ Top Integrations{% endif %}
    content: >
      {% set integs = state_attr('sensor.ha_log_analysis', 'by_integration') %}
      {% if integs %}
      {% for name, counts in (integs.items() | sort(attribute='1', reverse=true))[:5] %}
      **{{ name }}:** {{ counts.values() | sum }} ({% for s, c in counts.items() %}{{ s }}: {{ c }}{% if not loop.last %}, {% endif %}{% endfor %})
      {% endfor %}
      {% else %}
      {% set lang = states('input_select.ha_log_analyzer_language') %}
      {% if lang == 'fr' %}Aucune donn√©e.
      {% elif lang == 'de' %}Keine Daten.
      {% else %}No data.{% endif %}
      {% endif %}
