# ============================================
# DASHBOARD CARD - LOG ANALYZER
# Titles: English | Content: Multi-language (FR/EN/DE)
# ============================================

type: vertical-stack
cards:
  # Header avec stats globales
  - type: entities
    title: "ðŸ“Š HA Log Analysis"
    show_header_toggle: false
    entities:
      - entity: sensor.ha_log_analysis
        name: "Total Errors/Warnings"
        icon: mdi:alert-circle
      - type: attribute
        entity: sensor.ha_log_analysis
        attribute: total_entries
        name: "Total Entries"
        icon: mdi:file-document
      - entity: input_select.ha_log_analyzer_language
        name: "ðŸŒ Language"
      - entity: input_boolean.ha_log_analyzer_enabled
        name: "â° Auto Analysis"
      - type: divider
      - type: button
        name: "Analyze Now"
        icon: mdi:refresh
        tap_action:
          action: call-service
          service: script.analyze_logs_now

  # Top erreurs
  - type: markdown
    title: "ðŸ” Top Errors"
    content: >
      {% set top = state_attr('sensor.ha_log_analysis', 'top_errors') %}
      {% set lang = states('input_select.ha_log_analyzer_language') %}
      {% if top %}
      {% for err in top[:5] %}
      **{{ loop.index }}. [{{ err.integration }}]** x{{ err.count }}
      {{ err.message[:80] }}{% if err.message|length > 80 %}...{% endif %}

      {% endfor %}
      {% else %}
      {% if lang == 'fr' %}Aucune donnÃ©e. Lancez une analyse.
      {% elif lang == 'de' %}Keine Daten. FÃ¼hren Sie eine Analyse durch.
      {% else %}No data. Run an analysis.{% endif %}
      {% endif %}

  # Par sÃ©vÃ©ritÃ©
  - type: markdown
    title: "ðŸ“ˆ By Severity"
    content: >
      {% set sev = state_attr('sensor.ha_log_analysis', 'by_severity') %}
      {% set lang = states('input_select.ha_log_analyzer_language') %}
      {% if sev %}
      ðŸ”´ **CRITICAL:** {{ sev.CRITICAL | default(0) }}

      ðŸŸ  **ERROR:** {{ sev.ERROR | default(0) }}

      ðŸŸ¡ **WARNING:** {{ sev.WARNING | default(0) }}
      {% else %}
      {% if lang == 'fr' %}Aucune donnÃ©e.
      {% elif lang == 'de' %}Keine Daten.
      {% else %}No data.{% endif %}
      {% endif %}

  # Top intÃ©grations
  - type: markdown
    title: "ðŸ“¦ Top Integrations"
    content: >
      {% set integs = state_attr('sensor.ha_log_analysis', 'by_integration') %}
      {% set lang = states('input_select.ha_log_analyzer_language') %}
      {% if integs %}
      {% for name, counts in integs.items() %}
      {% if loop.index <= 5 %}
      **{{ name }}:** {{ counts.values() | sum }} ({% for s, c in counts.items() %}{{ s }}: {{ c }}{% if not loop.last %}, {% endif %}{% endfor %})

      {% endif %}
      {% endfor %}
      {% else %}
      {% if lang == 'fr' %}Aucune donnÃ©e.
      {% elif lang == 'de' %}Keine Daten.
      {% else %}No data.{% endif %}
      {% endif %}
